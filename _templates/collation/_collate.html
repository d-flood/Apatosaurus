{% load static crispy_forms_tags %}
<div class="flex flex-col items-center">
    <div class="flex flex-row items-center">
        <div id="ab-note-container"></div>
        <h2 class="text-4xl text-center my-12">
            Collate {{ ab.name }}
        </h2>
    </div>
</div>


<div class="bg-orange-100 dark:bg-cyan-1400 pb-10 pt-5 my-4 drop-shadow">
    <h3 class="text-2xl text-center my-4">Select Witnesses and Verses to Collate</h3>
    <p class="text-center my-4 italic">Note that running a collation will replace any existing variation units currently defined in this verse.</p>
    <div class="flex flex-col items-center w-full">
        <div class="flex flex-row flex-wrap" id="app-buttons-wrapper">
            {% block collate_form %}
                <form class="flex flex-col" id="collate-form" action="{% url 'collate' ab_pk=ab.pk %}" method="post">
                    <div id="form-success-msg" class="my-2"></div>
                    <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2">
                        {% csrf_token %}
                        {{ form|crispy }}
                    </div>
                    <button class="btn mt-4"
                        hx-post="{% url 'save-collate-config' ab_pk=ab.pk %}"
                        hx-target="#collate-form"
                        hx-include="#collate-form">
                        Save Collation Settings
                    </button>
                    <button class="btn-submit mt-4" type="submit">Collate Witnesses</button>
                </form>
            {% endblock collate_form %}
        </div>    
    </div>
</div>


{% block extra_js %}
<script>
   document.getElementById("witnesses_add_btn").addEventListener("click", () => {
        getValidVerseNames()
   })
    document.getElementById("basetext_add_btn").addEventListener("click", () => {
          getValidVerseNames()
    })

   function getValidVerseNames() {
    setTimeout(() => {
        document.getElementById("transcription_names_datalist").dispatchEvent(new Event("getAbNames"))
    }, 250)
   }
</script>
<script src="{% static 'peasywidgets.js' %}"></script>
{% endblock extra_js %}