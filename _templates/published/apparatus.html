{% extends 'base.html' %}
{% load static %}
{% block content %}
<div>
    <div class="flex">
        <div class="hidden lg:flex flex-col w-64 h-screen px-4 py-8 overflow-y-auto border-r bg-orange-50 dark:bg-darknav-secondary">
            <div class="flex flex-col justify-between mt-6">
                <h1 class="text-2xl text-center">{{ section.name }}</h1>
                <hr class="my-4 border-orange-700 border-t-4">
                <ul>
                    {% include 'published/verses.html' %}
                </ul>
            </div>
        </div>


        <main id="main" class="mx-3 mb-auto w-full">
            <div class="flex flex-col w-full items-center mt-2">
                {% if editor %}
                    {% include 'published/breadcrumbs/editor-collation-section-ab.html' %}
                {% else %}
                    {% include 'published/breadcrumbs/collation-section-ab.html' %}
                {% endif %}
            </div>

            <h2 class="text-4xl text-center my-12">Apparatus for {{ ab.name }}</h2>

            <div class="bg-orange-100 dark:bg-darknav-secondary pb-10 pt-5 my-4 drop-shadow">
                <h3 class="text-2xl text-center my-4">Variation Units</h3>
                <div class="flex flex-col items-center w-full">
                    <div class="flex flex-row flex-wrap" id="app-buttons-wrapper">
                        {% block app_buttons %}
                            {% for app in ab.apps.all %}
                                <button id="app-{{ app.pk }}" class="btn mx-2 my-1 py-0" type="button" 
                                    hx-get="{% url 'published-rdgs' app_pk=app.pk %}" 
                                    hx-target="#readings"
                                    _="on mouseenter add .bg-orange-300 .dark:bg-cyan-800 to .bt-{{ app.pk }} end
                                    on mouseleave remove .bg-orange-300 .dark:bg-cyan-800 from .bt-{{ app.pk }} end
                                    on click remove .selected from .app-button then add .selected to me 
                                    then remove .selected from <td/> then add .selected to .bt-{{ app.pk }} end">
                                    {{ app.index_from }}{% if app.index_from != app.index_to %}â€“{{ app.index_to }}{% endif %}
                                </button>
                            {% endfor %}
                        {% endblock app_buttons %}
                    </div>
                </div>
            </div>
            
            <div class="bg-orange-100 dark:bg-darknav-secondary pb-10 pt-5 my-4 drop-shadow">
                <h3 class="text-2xl text-center my-4">Basetext - {{ ab.basetext_label }}</h3>
                <div class="flex flex-col items-center">
                    <table id="basetext" class="table-auto">
                        <tbody id="basetext_table_body">
                            {% block basetext_row %}
                                <tr class="flex flex-row flex-wrap"
                                    hx-get="{% url 'refresh-basetext' ab_pk=ab.pk %}"
                                    hx-target="#basetext_table_body" hx-trigger="refreshBasetext from:body">
                                    <th scope="row" class="px-2">Basetext<br>Index</th>
                                    {% for word in ab.indexed_basetext %}
                                        {% if word.is_variant %}
                                            <td class="text-center bt-{{ word.app_pk }} px-2 border-b-4 border-b-orange-700 cursor-pointer" tabindex="0" hx-get="{% url 'published-rdgs' app_pk=word.app_pk %}" hx-target="#readings"
                                                _="on mouseenter add .bg-orange-300 .dark:bg-cyan-800 to .bt-{{ word.app_pk }} then add .bg-orange-400 .dark:bg-cyan-800 to #app-{{ word.app_pk }} end
                                                on mouseleave remove .bg-orange-300 .dark:bg-cyan-800 from .bt-{{ word.app_pk }} then remove .bg-orange-400 .dark:bg-cyan-800 from #app-{{ word.app_pk }} end
                                                on click remove .selected from <td/> then add .selected to .bt-{{ word.app_pk }} 
                                                then remove .selected from .app-button then add .selected to #app-{{ word.app_pk }}">
                                                {{ word.word }}<br>{{ word.index }}
                                            </td>
                                        {% else %}
                                            <td class="text-center px-2">
                                                {{ word.word }}<br>{{ word.index }}
                                            </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            {% endblock basetext_row %}
                        </tbody>
                    </table>
                </div>
            </div>
            <h4 class="center">Readings</h4>
            <div id="readings"></div>
        </main>



    </div>
</div>

<style>
    {% for app in ab.apps.all %}
        td:not(.bt-{{ app.pk }}) + td.bt-{{ app.pk }} {
            border-left: solid 4px #bd461d;
            margin-left: 15px;
        }
        td.bt-{{ app.pk }}:first-of-type {
            border-left: solid 4px #bd461d;
            margin-left: 15px;
        }
    {% endfor %}
</style>
{% endblock content %}